<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Instagram Clone</title>
<style>
body { font-family: Arial; background:#fafafa; }
.box { max-width:400px; margin:auto; background:white; padding:15px; }
input,textarea,button { width:100%; margin-top:8px; padding:8px; }
.post { border:1px solid #ddd; padding:10px; margin-top:10px; }
img { width:100%; border-radius:5px; }
small { color:gray; }
</style>
</head>

<body>
<div class="box">
<h3>Login / Register</h3>
<input id="name" placeholder="Name">
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Password">
<button onclick="register()">Register</button>
<button onclick="login()">Login</button>
<p id="msg"></p>

<hr>

<h3>Create Post</h3>
<textarea id="caption" placeholder="Caption"></textarea>
<input id="image" placeholder="Image URL (optional)">
<button onclick="createPost()">Post</button>

<div id="feed"></div>
</div>

<script>
let token = "";

async function register() {
  const res = await fetch("/register", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      name:name.value,
      email:email.value,
      password:password.value
    })
  });
  msg.innerText = (await res.json()).message || "Error";
}

async function login() {
  const res = await fetch("/login", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      email:email.value,
      password:password.value
    })
  });
  const data = await res.json();
  token = data.token;
  msg.innerText = token ? "Logged in ‚úÖ" : "Login failed";
}

async function createPost() {
  await fetch("/post", {
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization": token
    },
    body:JSON.stringify({
      caption:caption.value,
      image:image.value
    })
  });
  caption.value=""; image.value="";
  loadFeed();
}

async function like(id) {
  await fetch("/like/" + id, { method:"POST" });
  loadFeed();
}

async function comment(id) {
  const text = prompt("Comment:");
  if (!text) return;
  await fetch("/comment/" + id, {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({ text })
  });
  loadFeed();
}

async function loadFeed() {
  const res = await fetch("/feed");
  const posts = await res.json();
  feed.innerHTML = "";

  posts.forEach(p => {
    feed.innerHTML += `
      <div class="post">
        <p>${p.caption}</p>
        ${p.image ? `<img src="${p.image}">` : ""}
        <small>${p.likes} likes</small><br>
        <button onclick="like('${p._id}')">‚ù§Ô∏è Like</button>
        <button onclick="comment('${p._id}')">üí¨ Comment</button>
        ${p.comments.map(c=>`<p>- ${c.text}</p>`).join("")}
      </div>
    `;
  });
}

loadFeed();
</script>
</body>
</html>
